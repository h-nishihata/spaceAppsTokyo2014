<html>
  <head>
    <title>Habitable Zone | Globe Mode</title>
    <style>
      body {
        font-family: Monospace;
        background-color: #000;
        margin: 0px;
        overflow: hidden;
      }
    </style>
  </head>
  <body>
    <script src="js/three.min.58.js"></script>
    <script src="js/TrackballControls.js"></script>
    <script src="js/PersonalCosmos.js"></script>
    <script src="js/Detector.js"></script>
    <script>
      if ( ! Detector.webgl ) Detector.addGetWebGLMessage();

      var container;
      var camera, controls, scene, renderer;
      var object;
      var points = [];
      var map;

      init();
      animate();

      function init() {

        container = document.createElement( 'div' );
        document.body.appendChild( container );

        camera = new THREE.PerspectiveCamera( 11, window.innerWidth / window.innerHeight, 1, 2000 );
        camera.position.z = 100;

        controls = new THREE.TrackballControls( camera );
        controls.rotateSpeed = 0.5;
        controls.zoomSpeed = 0.5;
        controls.panSpeed = 0.05;

        scene = new THREE.Scene();
        scene.add( new THREE.AmbientLight( 0xffffff ) );

        map = THREE.ImageUtils.loadTexture( 'basemap/EARTH.jpg' );//ノーマル地球
        map.wrapS = map.wrapT = THREE.RepeatWrapping;
        map.anisotropy = 16;

        var materials = [
          new THREE.MeshLambertMaterial( { ambient: 0xbbbbbb, map: map, side: THREE.DoubleSide } ),
          new THREE.MeshBasicMaterial( { color: 0xffffff, wireframe: false, transparent: true, opacity: 0.1, side: THREE.DoubleSide } )
        ];

        for ( var i = 0; i < 10; i ++ ) {
          points.push( new THREE.Vector3( 0, i, 0 ) );
        }

        object = THREE.SceneUtils.createMultiMaterialObject( new PersonalCosmos( points, 100 ), materials );
        scene.add( object );

        renderer = new THREE.WebGLRenderer( { antialias: false } );
        renderer.setSize( window.innerWidth, window.innerHeight );

        container.appendChild( renderer.domElement );

        window.addEventListener( 'resize', onWindowResize, false );

        window.addEventListener('dragover', function(event) {
          event.preventDefault();
        }, false);

        window.addEventListener( 'drop', function(event) {
          onFileDrop(event);
        }, false );
      }

      function onWindowResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();

        renderer.setSize( window.innerWidth, window.innerHeight );
      }

      function animate() {
        requestAnimationFrame( animate );
        render();
        }

        function render() {
        var timer = Date.now() * 0.0001;

        camera.lookAt( scene.position );

        for ( var i = 0, l = scene.children.length; i < l; i ++ ) {
        var obj = scene.children[ i ];
        obj.rotation.z = -timer * 1.0;
      }

      controls.update();
      renderer.render( scene, camera );
      }

      function onFileDrop(event){
        var image = new Image();
        var file = event.dataTransfer.files[0]
        var reader = new FileReader();
          reader.onload = function(e) {
          image.src = reader.result;
        };
        reader.readAsDataURL(file);
        image.onload = function() {
          var canvas = document.createElement("canvas");
          canvas.width=1024;
          canvas.height=1024;
          var ctx = canvas.getContext("2d");
          ctx.drawImage(image, 0, 0, image.width, image.height, 0, 0, canvas.width, canvas.height);
          map = new THREE.Texture( canvas, new THREE.UVMapping(), THREE.ClampToEdgeWrapping, THREE.ClampToEdgeWrapping, THREE.NearestFilter,THREE.NearestMipMapLinearFilter);
          map.needsUpdate = true;
          map.wrapS = map.wrapT = THREE.RepeatWrapping;
          map.anisotropy = 16;
          var materials = [
            new THREE.MeshLambertMaterial( { ambient: 0xbbbbbb, map: map, side: THREE.DoubleSide } ),
            new THREE.MeshBasicMaterial( { color: 0xffffff, wireframe: false, transparent: true, opacity: 0.1, side: THREE.DoubleSide } )
          ];
          scene.remove(object);
          object = THREE.SceneUtils.createMultiMaterialObject( new PersonalCosmos( points, 100 ), materials );
          scene.add(object );
        }
        event.preventDefault();

        event.stopPropagation();
      }
    </script>
  </body>
</html>
